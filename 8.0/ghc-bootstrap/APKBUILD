#-*-mode: Shell-script; coding: utf-8;-*-
# Maintainer: Mitch Tishmack <mitch.tishmack@gmail.com>
#
# Build/bootstrap ghc similarly to the go package.
# Caveat: bootstrapping isn't a commonly tested piece of ghc.
pkgname=ghc-bootstrap
pkgdesc="The Glasgow haskell compiler (bootstrapped)"
apkgver=8.0
pkgrel=0
pkgver=$(echo ${apkgver} | tr -d '[a-z]')
url="http://haskell.org"
subpackages=""
arch="x86_64 armhf"
_arch=$CARCH
if [ $CARCH == "armhf" ]; then
	_arch=arm
fi
source="https://s3-us-west-2.amazonaws.com/alpine-ghc/next/ghc-8.0.1-${_arch}-unknown-linux-musl.tar.xz"
license="custom:bsd3"
depends="bash libffi musl zlib gcc binutils-gold ghc-llvm-3.7"
install=""
subpackages=""
makedepends="perl"

package() {
	cd "$srcdir"
	install -d "$pkgdir" || return 1
	mv usr "$pkgdir" || return 1
	settings=$(find "$pkgdir" -name settings -type f)
}

# The bootstrap process uses docker to build ghc from a debian glibc host
# then upload the bootstrap compiler to where that source url is.
#
# Ensure that docker is running prior to calling this.
snapshot () {
	make 
	scp "ghc-$pkgver-$bs_arch-unknown-linux-musl.tar.xz" dev.alpinelinux.org:/archive/ghc-bootstrap/ || return 1
}
md5sums="61869333a2fc7011563c5ac3e2c3710c  ghc-8.0.1-x86_64-unknown-linux-musl.tar.xz"
sha256sums="8318232010dec25180aba6c77038566a4862f4ccd9ddc53d1a4bf1fc667d5710  ghc-8.0.1-x86_64-unknown-linux-musl.tar.xz"
sha512sums="90cd2454354cb91757cc5b626f2d036cb890b45dbe38339dd84c391e477a88cb614a88ed05f305b51645a53e7a1bb1c8e25aaa2156c294e22823f5d1234257af  ghc-8.0.1-x86_64-unknown-linux-musl.tar.xz"
