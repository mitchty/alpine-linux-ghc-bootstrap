# Contributor: Mitch Tishmack <mitch.tishmack@gmail.com>
# Maintainer: Mitch Tishmack <mitch.tishmack@gmail.com>
pkgname=cabal-install
pkgver=1.22.6.0
pkgrel=2
pkgdesc="The Haskell Cabal"
url="http://haskell.org"
arch="x86_64"
license="custom"
depends="zlib"
makedepends="bash gmp-dev zlib-dev linux-headers ghc gzip"
install=""
subpackages="$pkgname-doc"
source="https://www.haskell.org/cabal/release/cabal-install-$pkgver/cabal-install-$pkgver.tar.gz"
_builddir="$srcdir/$pkgname-$pkgver"

build() {
	cd "$_builddir"
	export PATH="${PATH}:$_builddir/.cabal-sandbox/bin"
	export NO_DOCUMENTATION=1
	export EXTRA_CONFIGURE_OPTS=""
	./bootstrap.sh --sandbox || return 1
	# yeah technically we build twice, but its mostly due to
	# the bootstrap build not being fully static and having a
	# polluted rpath
	cabal update || return 1
	cabal sandbox init || return 1
	cabal install --only-dependencies || return 1
	cabal build --ghc-option=-optl=-static --ghc-option=-optl=-pthread || return 1
}

package() {
	cd "$_builddir"
	install -d "$pkgdir/usr/bin" || return 1
	pkg_cabal="$_builddir/dist/build/cabal/cabal"
	install -m755 "$pkg_cabal" "$pkgdir/usr/bin" || return 1
	install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE" || return 1
}
md5sums="0463650044697ea337705ea9e29a0221  cabal-install-1.22.6.0.tar.gz"
sha256sums="9d239e385696a7faa49f068aea451882baec6a7df26fbddbd08271c9053cb0b4  cabal-install-1.22.6.0.tar.gz"
sha512sums="155227a0bc29f8d6c9ec9846f1dbd956234853b1301fa15ab81aaee654abba8bfbd19cbb608008427b1272bff7aa397830011855b85d0a13deb9ebd1485cab14  cabal-install-1.22.6.0.tar.gz"
