# Contributor: Mitch Tishmack <mitch.tishmack@gmail.com>
# Maintainer: Mitch Tishmack <mitch.tishmack@gmail.com>
pkgname=cabal
pkgver=1.22.7.0
pkgrel=0
pkgdesc="The Haskell Cabal"
url="http://haskell.org"
arch="x86_64"
license="custom"
depends=""
makedepends="ghc ghc-dev"
install=""
subpackages=""
source="https://www.haskell.org/cabal/release/cabal-install-$pkgver/cabal-install-$pkgver.tar.gz"
_builddir="$srcdir/$pkgname-install-$pkgver"

build() {
	cd "$_builddir"
	(
		export HOME="$_builddir"
		export PATH="$_builddir/.cabal-sandbox/bin:${PATH}"
		export NO_DOCUMENTATION=1
		export EXTRA_BUILD_OPTS="--ghc-option=-fPIC"
		./bootstrap.sh --sandbox || return 1
		export EXTRA_BUILD_OPTS="--ghc-option=-optl=-static --ghc-option=-optl=-pthread --ghc-option=-fPIC"
		./bootstrap.sh --sandbox || return 1
	) || return 1
}

package() {
	cd "$_builddir"
	install -d "$pkgdir/usr/bin" || return 1
	install -m755 "$_builddir/dist/build/cabal/cabal" "$pkgdir/usr/bin/cabal" || return 1
	install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE" || return 1
}
