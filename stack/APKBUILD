# Contributor: Mitch Tishmack <mitch.tishmack@gmail.com>
# Maintainer: Mitch Tishmack <mitch.tishmack@gmail.com>
pkgname=stack
pkgver=0.1.3.1
pkgrel=0
pkgdesc="Stack"
url="https://github.com/commercialhaskell/stack"
arch="x86_64"
license="bsd3"
depends="ghc zlib ca-certificates"
makedepends="bash gmp-dev zlib-dev linux-headers ghc gzip cabal-install musl-dev chrpath"
install=""
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/commercialhaskell/stack/archive/v$pkgver.tar.gz"
_builddir="$srcdir/$pkgname-$pkgver"

build() {
	cd "$_builddir"
	export PATH="${PATH}:$_builddir/.cabal-sandbox/bin"
	export OHOME="$HOME"
	export HOME="$_builddir"
	cabal update || return 1
	cabal sandbox init || return 1
	cabal install --only-dependencies || return 1
#	cabal build --ghc-option=-optl=-static --ghc-option=-optl=-pthread || return 1
	cabal install -v3 || return 1
	export HOME="$OHOME"
}

package() {
	cd "$_builddir"
	install -d "$pkgdir/usr/bin" || return 1
	pkg_stack="$_builddir/.cabal-sandbox/bin/$pkgname"
	chrpath -r '$ORIGIN/../lib64' "$pkg_stack" || return 1
	install -m755 "$pkg_stack" "$pkgdir/usr/bin" || return 1
	install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE" || return 1
}
md5sums="1029d6d239d1cead55872dedd2b9a5c8  stack-0.1.3.1.tar.gz"
sha256sums="3e6a575a3f5206af345912c4deba9552dfb156391357cec4eb1c2a9028ba4c51  stack-0.1.3.1.tar.gz"
sha512sums="c5626cb76ce30d38c27eab39ad65ee93817baf5c17a52afc62508f2ca16bf06e545a91de933d1e34f292f0b12b7575e890e0d2154fcdd396dea66435204efde8  stack-0.1.3.1.tar.gz"
